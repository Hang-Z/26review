<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多模态实人认证系统 - AIGC检测演示</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #dee2e6;
        }
         
    
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .header h1 {
            font-size: 32px;
            color: #212529;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #6c757d;
            font-size: 16px;
        }
        
        .case-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .case-btn {
            padding: 10px 20px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            color: #495057;
            font-weight: 500;
        }
        
        .case-btn:hover {
            border-color: #1a73e8;
            color: #1a73e8;
            background: #f8f9ff;
        }
        
        .case-btn.active {
            background: #1a73e8;
            color: white;
            border-color: #1a73e8;
        }
        
        /* 输入区域 - 横向布局 */
        .input-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 18px;
            color: #212529;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #1a73e8;
            border-radius: 2px;
        }
        
        .input-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }
        
        .image-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .original-image {
            width: 100%;
            max-width: 270px;
            height: auto;
            border-radius: 6px;
        }
        
        .prompt-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #dee2e6;
        }
        
        .prompt-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .prompt-text {
            color: #495057;
            line-height: 1.7;
            font-size: 13px;
            max-height: 350px;
            overflow-y: auto;
        }
        
        .prompt-text::-webkit-scrollbar {
            width: 6px;
        }
        
        .prompt-text::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .prompt-text::-webkit-scrollbar-thumb {
            background: #adb5bd;
            border-radius: 3px;
        }
        
        .run-button {
            width: 200px;
            padding: 14px;
            background: #1a73e8;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 25px auto 0;
            display: block;
        }
        
        .run-button:hover {
            background: #1557b0;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
        }
        
        .run-button:active {
            transform: translateY(0);
        }
        
        .run-button.running {
            background: #28a745;
            cursor: not-allowed;
        }
        
        /* 输出区域 */
        .output-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
        }
        
        .response-container {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .response-container.show {
            opacity: 1;
        }
        
        /* 第一轮输出 - 全宽 */
        .response-box-full {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #dee2e6;
        }
        
        .response-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .round-badge {
            background: #1a73e8;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .response-text {
            color: #212529;
            line-height: 1.8;
            font-size: 14px;
            white-space: pre-wrap;
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        /* 第二轮输出 - 左右布局 */
        .crop-section {
            opacity: 0;
            transition: all 0.5s ease;
        }
        
        .crop-section.show {
            opacity: 1;
        }
        
        .second-round-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #dee2e6;
        }
        
        .crop-image-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .crop-image {
            width: 100%;
            max-width: 250px;
            height: auto;
            border-radius: 6px;
            border: 2px solid #1a73e8;
            margin-top: 10px;
        }
        
        .second-response-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #dee2e6;
        }
        
        .token-highlight {
            background: #fff3cd;
            color: #856404;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            border: 1px solid #ffc107;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            margin-top: 15px;
        }
        
        .status-indicator.detecting {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }
        
        .status-indicator.cropping {
            background: #cfe2ff;
            color: #084298;
            border: 1px solid #6ea8fe;
        }
        
        .status-indicator.complete {
            background: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        
        .spinner {
            width: 14px;
            height: 14px;
            border: 2px solid currentColor;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .confidence-meter {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .confidence-label {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 8px;
        }
        
        .confidence-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%);
            width: 0%;
            transition: width 1s ease;
        }
        
        .confidence-value {
            font-size: 14px;
            font-weight: 600;
            color: #212529;
            margin-top: 5px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .input-content {
                grid-template-columns: 1fr;
            }
            
            .second-round-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔍 多模态实人认证系统</h1>
            <p>基于多模态大模型AIGC细粒度检测的演示</p>
        </div>
        
        <div class="case-selector">
            <button class="case-btn active" onclick="selectCase(1)">Case 1: 低置信，多轮推理</button>
            <button class="case-btn" onclick="selectCase(2)">Case 2: 低置信，多轮推理</button>
            <button class="case-btn" onclick="selectCase(3)">Case 3: 高置信，直接判定</button>
        </div>
        
        <!-- 输入区域 -->
        <div class="input-section">
            <h3 class="section-title">输入数据</h3>
            
            <div class="input-content">
                <div class="image-container">
                    <img id="original-image" src="case1.png" alt="原始图像" class="original-image">
                </div>
                
                <div class="prompt-box">
                    <div class="prompt-label">📝 输入Prompt</div>
                    <div id="prompt-text" class="prompt-text">
                        <!-- Prompt内容将通过JavaScript动态加载 -->
                    </div>
                </div>
            </div>
            
            <button id="run-button" class="run-button" onclick="runInference()">
                开始推理分析
            </button>
        </div>
        
        <!-- 输出区域 -->
        <div class="output-section">
            <h3 class="section-title">推理结果</h3>
            
            <div id="response-container" class="response-container">
                <!-- 第一轮输出 -->
                <div class="response-box-full">
                    <div class="response-label">
                        <span class="round-badge">第一轮</span>
                        初步分析
                    </div>
                    <div id="response1" class="response-text"></div>
                    
                    <div class="confidence-meter">
                        <div class="confidence-label">置信度评估（注意力熵）</div>
                        <div class="confidence-bar">
                            <div id="confidence-fill" class="confidence-fill"></div>
                        </div>
                        <div id="confidence-value" class="confidence-value"></div>
                    </div>
                    
                    <div id="status1" class="status-indicator"></div>
                </div>
                
                <!-- 第二轮输出 -->
                <div id="crop-section" class="crop-section">
                    <div class="second-round-container">
                        <div class="crop-image-container">
                            <div class="response-label">🔍 关键区域放大</div>
                            <img id="crop-image" src="" alt="裁剪区域" class="crop-image">
                        </div>
                        
                        <div class="second-response-box">
                            <div class="response-label">
                                <span class="round-badge">第二轮</span>
                                细粒度分析
                            </div>
                            <div id="response2" class="response-text" style="background: transparent; padding: 0; border: none;"></div>
                            <div id="status2" class="status-indicator"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 案例数据
        const caseData = {
            1: {
                image: 'case1.png',
                cropImage: 'case1-crop.png',
                prompt: '当前任务是对用户提交的活体图像进行实人认证，重点检测是否存在AI换脸攻击。<br><br> 认证场景为Rubbish_rp。来自MobileTaobao业务。使用IOS系统。 <br> 用户从中国香港发起认证，使用设备：Apple iPhone X，系统版本15.7，屏幕分辨率1125*2436，网络类型未知，电量99%，设备类型为iOS，CPU架构arm64。 <br> 设备唯一标识缺失，这本身就是一个重要的风险信号。 设备环境检测未发现明显异常。<br>  用户行为分析：同IP地址24小时内被拦截24次, 当前业务场景24小时内认证失败7次, 该设备24小时内提交了10个不同身份证, 同IP地址24小时内认证通过11次, 近1天同身份证认证涉及1个店铺。<br>  数据质量异常：活体数据采集延迟达11607毫秒（严重延迟，可能存在中间人攻击），设备未插入SIM卡。 <br><br> 请综合分析：1)人脸与身份信息的匹配度；<br> 2)不同动作下人脸的连贯性和自然度；<br> 3)是否存在AI生成的边缘模糊、光影不一致等特征；<br> 4)结合设备环境和行为模式判断整体风险。<br><br> 请按以下输出结构进行分析：<br>【图像分析】（描述人脸及背景的可疑特征）<br>【风险信号】（设备环境和用户行为异常） <br>【综合研判】（结合图像和风险信号的整体判断）<br> 请在分析结束后，必须给出明确的判别结果是否为攻击，格式为，判别结果：是/否，并说明原因',
                response1: '判别结果：是 <br>【图像分析】<br>人脸区域清晰，五官完整，为青年男性。光照主要来自右侧，面部光影过渡基本自然，符合常规摄像头成像特征。皮肤纹理细节保留尚可，未观察到明显的压缩或涂抹痕迹；背景文字区域<span class="token-highlight">&lt;NEED_ZOOM&gt;</span>文字笔画存在不自然的扭曲和粘连；人脸边缘与背景的融合过渡不够自然。<br>【风险信号】<br> 设备唯一标识缺失，是典型的黑产工具或虚拟环境特征。设备未插入SIM卡，不符合正常用户使用习惯；同IP地址24小时内被拦截24次，认证失败7次，该设备24小时内提交10个不同身份证，同IP/设备在24小时内关联了大量失败认证、多身份提交和高频拦截记录；活体数据采集延迟达11607毫秒，本次认证可能并非通过摄像头实时采集。<br>【综合研判】<br> 图像维度存在可疑区域，设备、行为、数据链路均存在多处较高可疑特征，暗示较高换脸风险。<br>',
                response2: '判别结果：是 <br>【区域分析】<br>经对第一轮发现的可疑区域进行局部放大，可以明确观察到标识牌上的文字“火栓”存在严重的生成错误。\n笔画呈现不规则的弯曲和粗细变化，特别是右侧的“捺”笔画，出现了不符合书写或印刷逻辑的粘连。<br>【综合研判】<br> 行为与设备环境存在完整、明确的攻击特征链条；同时，图像背景中的文字在放大后呈现出典型的AIGC生成错误特征，伪造证据确凿。\n',
                confidence: 62,
                needZoom: true
            },
            2: {
                image: 'case2.png',
                cropImage: 'case2-crop.png',
                prompt: '当前任务是对用户提交的活体图像进行实人认证，重点检测是否存在AI换脸攻击。 <br><br> 认证场景为KnightRegister。来自Eleme业务。使用IOS系统。<br>  用户从中国广东深圳发起认证，使用设备：Apple iPhone 16，系统版本18.5，屏幕分辨率1179*2556，wifi网络，电量85%，设备类型为iOS，CPU架构arm64。 <br> 设备唯一标识缺失，这本身就是一个重要的风险信号。 设备环境检测未发现明显异常。 <br>  用户行为分析：同IP地址24小时内被拦截1次, 当前业务场景24小时内认证失败1次, 同一身份证24小时内在该场景认证1次, 该设备24小时内提交了1个不同身份证, 同IP地址24小时内认证通过28次。<br>  数据质量异常：活体数据采集延迟1656毫秒。 <br> <br> 请综合分析：1)人脸与身份信息的匹配度； <br>2)不同动作下人脸的连贯性和自然度； <br>3)是否存在AI生成的边缘模糊、光影不一致等特征； <br>4)结合设备环境和行为模式判断整体风险。 <br><br>  请综合分析：1)人脸与身份信息的匹配度； <br> 2)不同动作下人脸的连贯性和自然度； <br> 3)是否存在AI生成的边缘模糊、光影不一致等特征； <br> 4)结合设备环境和行为模式判断整体风险。<br><br> 请按以下输出结构进行分析：<br>【图像分析】（描述人脸及背景的可疑特征）<br>【风险信号】（设备环境和用户行为异常） <br>【综合研判】（结合图像和风险信号的整体判断）<br> 请在分析结束后，必须给出明确的判别结果是否为攻击，格式为，判别结果：是/否，并说明原因',
                response1: '判别结果：否 <br>【图像分析】<br>图像整体清晰，为青年女性在夜间室外场景拍摄。人脸五官结构正常，面部存在自然的雀斑、微小瑕疵和皮肤纹理，符合真实人脸光学成像特征。面部光照主要来自前方，光影分布均匀且自然，未见明显的光源不一致、边缘切割或AI生成伪影。人脸右侧头发丝与背景建筑物的边界处，因夜间拍摄和景深原因，清晰度略有下降<span class="token-highlight">&lt;NEED_ZOOM&gt;</span><br>【风险信号】<br>设备唯一标识缺失，是需要关注的高危风险信号；同IP地址24小时内认证通过高达28次，显著超出正常个人用户行为范畴，IP地址聚集性风险高；数据采集延迟1656毫秒，略高于正常但在可接受范围；设备为最新iPhone 16，系统版本18.5，硬件配置正常。<br>【综合研判】<br>图像本身未发现明确伪造特征，但是行为风险较高，特别是IP地址的聚集性风险。图像整体自然，需对图像细节进行放大复核。<br> ',
                response2: '判别结果：否 <br>【区域分析】<br>发丝边缘呈现自然的粗细变化和光泽反射，与背景的边界清晰且符合光学成像原理，未见AIGC生成的“粘贴”感。放大后，皮肤表面的微小纹理和毛孔细节依然清晰可见，分布随机自然，符合真实皮肤特征。<br>【综合研判】<br> 尽管该用户的行为与设备环境存在与高风险群体相似的特征，但认证图像在全局和局部细粒度层面均未发现任何AI生成或伪造的证据。',
                confidence: 45,
                needZoom: true
            },
            3: {
                image: 'case3.png',
                cropImage: '',
                prompt: '当前任务是对用户提交的活体图像进行实人认证，重点检测是否存在AI换脸攻击。<br><br>  认证场景为Verify。来自QYJR业务。使用ANDROID系统。 <br>  用户从未知地区发起认证，使用设备：Redmi M2012K11C，系统版本13，屏幕分辨率1080*2400，网络类型未知，电量45%，设备类型为Android，CPU架构arm64-v8a。  <br> 设备唯一标识缺失，这本身就是一个重要的风险信号。 设备检测发现1类风险：环境异常（ADB调试开启）。 <br>  用户行为分析：同IP地址24小时内被拦截8次, 当前业务场景24小时内认证失败8次, 同一身份证24小时内在该场景认证17次, 该设备24小时内提交了1个不同身份证。 <br>  数据质量异常：活体数据采集延迟1867毫秒。 <br><br>  请综合分析：1)人脸与身份信息的匹配度； <br> 2)不同动作下人脸的连贯性和自然度； <br> 3)是否存在AI生成的边缘模糊、光影不一致等特征； <br> 4)结合设备环境和行为模式判断整体风险。<br><br> 请按以下输出结构进行分析：<br>【图像分析】（描述人脸及背景的可疑特征）<br>【风险信号】（设备环境和用户行为异常） <br>【综合研判】（结合图像和风险信号的整体判断）<br> 请在分析结束后，必须给出明确的判别结果是否为攻击，格式为，判别结果：是/否，并说明原因',
                response1: '判别结果：是<br>【图像分析】<br>图像清晰度较高，主体为中年男性，正脸视角。双眼瞳孔中的反射光斑形状、大小和位置完全不一致，不符合单一光源下的正常光学成像原理。左眼的反射光斑模糊，而右眼则相对清晰，存在明显矛盾。背景为室内场景，墙面与物体的接缝处线条存在轻微的扭曲和断裂。左右两侧耳朵的轮廓和内部结构存在非对称性异常。<br>【风险信号】<br>设备唯一标识缺失；同时检测到ADB调试模式开启，此为开发者或攻击者进行设备操控的典型特征；同IP地址24小时内被拦截8次，同一身份证24小时内认证17次，表现出明显的批量、自动化攻击尝试；数据采集延迟1867毫秒，配合ADB确认为脚本攻击。<br>【综合研判】<br> 图像分析揭示了瞳孔反光不一致、耳朵不对称等多个决定性的AIGC生成特征。同时，风险信号分析也发现了ADB调试开启、行为模式高度异常等明确的攻击者画像。',
                response2: '',
                confidence: 94,
                needZoom: false
            }
        };
        
        let currentCase = 1;
        let isRunning = false;
        
        function selectCase(caseNum) {
            currentCase = caseNum;
            
            // 更新按钮状态
            document.querySelectorAll('.case-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 更新显示内容
            const data = caseData[caseNum];
            document.getElementById('original-image').src = data.image;
            document.getElementById('prompt-text').innerHTML = data.prompt;
            
            // 重置输出
            resetOutput();
        }
        
        function resetOutput() {
            document.getElementById('response-container').classList.remove('show');
            document.getElementById('response1').innerHTML = '';
            document.getElementById('response2').innerHTML = '';
            document.getElementById('crop-section').classList.remove('show');
            document.getElementById('status1').innerHTML = '';
            document.getElementById('status2').innerHTML = '';
            document.getElementById('confidence-fill').style.width = '0%';
            document.getElementById('confidence-value').textContent = '';
            document.getElementById('run-button').classList.remove('running');
            document.getElementById('run-button').textContent = '开始推理分析';
            isRunning = false;
        }
        
        async function runInference() {
            if (isRunning) return;
            isRunning = true;
            
            const data = caseData[currentCase];
            const button = document.getElementById('run-button');
            button.classList.add('running');
            button.textContent = '推理中...';
            
            // 重置输出
            document.getElementById('response1').innerHTML = '';
            document.getElementById('response2').innerHTML = '';
            document.getElementById('crop-section').classList.remove('show');
            
            // 显示响应容器
            document.getElementById('response-container').classList.add('show');
            
            // 第一轮推理
            document.getElementById('status1').innerHTML = '<div class="spinner"></div> 正在分析...';
            document.getElementById('status1').className = 'status-indicator detecting';
            
            await typeWriter('response1', data.response1);
            
            // 显示置信度
            setTimeout(() => {
                document.getElementById('confidence-fill').style.width = data.confidence + '%';
                document.getElementById('confidence-value').textContent = `${data.confidence}% - ${data.confidence > 80 ? '高置信度' : '低置信度'}`;
            }, 500);
            
            if (data.needZoom) {
                // 检测到NEED_ZOOM token
                document.getElementById('status1').innerHTML = '⚠️ 检测到特殊Token';
                document.getElementById('status1').className = 'status-indicator detecting';
                
                await delay(1000);
                
                // 触发裁剪
                document.getElementById('status1').innerHTML = '🔍 触发局部放大';
                document.getElementById('status1').className = 'status-indicator cropping';
                
                await delay(800);
                
                // 显示裁剪区域
                document.getElementById('crop-section').classList.add('show');
                document.getElementById('crop-image').src = data.cropImage;
                
                await delay(500);
                
                // 第二轮推理
                document.getElementById('status2').innerHTML = '<div class="spinner"></div> 细粒度分析中...';
                document.getElementById('status2').className = 'status-indicator detecting';
                
                await typeWriter('response2', data.response2);
                
                document.getElementById('status2').innerHTML = '✅ 分析完成';
                document.getElementById('status2').className = 'status-indicator complete';
            } else {
                document.getElementById('status1').innerHTML = '✅ 高置信度判定完成';
                document.getElementById('status1').className = 'status-indicator complete';
            }
            
            button.classList.remove('running');
            button.textContent = '重新分析';
            isRunning = false;
        }
        
        async function typeWriter(elementId, htmlText) {
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            
            // 将HTML文本分解为纯文本和标签
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlText, 'text/html');
            const walker = document.createTreeWalker(
                doc.body,
                NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,
                null,
                false
            );
            
            let currentHTML = '';
            let node;
            
            while (node = walker.nextNode()) {
                if (node.nodeType === Node.TEXT_NODE) {
                    // 逐字显示文本
                    const text = node.textContent;
                    for (let i = 0; i < text.length; i++) {
                        currentHTML = htmlText.substring(0, htmlText.indexOf(text) + i + 1);
                        element.innerHTML = currentHTML;
                        await delay(20); // 调整速度
                    }
                }
            }
            
            // 最后确保完整显示
            element.innerHTML = htmlText;
        }
        
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // 初始化第一个案例
        window.onload = function() {
            const data = caseData[1];
            document.getElementById('prompt-text').innerHTML = data.prompt;
        };
    </script>
</body>
</html>